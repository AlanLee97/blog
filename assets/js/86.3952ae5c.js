(window.webpackJsonp=window.webpackJsonp||[]).push([[86],{539:function(t,a,s){"use strict";s.r(a);var n=s(0),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"kubernetes-修改默认的端口范围"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes-修改默认的端口范围"}},[t._v("#")]),t._v(" Kubernetes 修改默认的端口范围")]),t._v(" "),s("p",[t._v("Kubernetes 服务的 NodePort 默认端口范围是 30000-32767，在某些场合下，这个限制不太适用，我们可以自定义它的端口范围，操作步骤如下：")]),t._v(" "),s("p",[t._v("编辑 "),s("code",[t._v("vi /etc/kubernetes/manifests/kube-apiserver.yaml")]),t._v(" 配置文件，增加配置 "),s("code",[t._v("--service-node-port-range=2-65535")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("creationTimestamp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token null important"}},[t._v("null")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("component")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("apiserver\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tier")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" control"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("plane\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("apiserver\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" kube"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("apiserver\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在这里增加配置即可")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("port"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("range=2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("65535")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("advertise"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("address=192.168.141.150\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("allow"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("privileged=true\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("authorization"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("mode=Node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("RBAC\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ca"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("file=/etc/kubernetes/pki/ca.crt\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("enable"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("admission"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("plugins=NodeRestriction\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("enable"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("bootstrap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("token"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth=true\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("etcd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cafile=/etc/kubernetes/pki/etcd/ca.crt\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("etcd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("certfile=/etc/kubernetes/pki/apiserver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("etcd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("client.crt\n// 以下配置省略"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n")])])]),s("p",[t._v("使用 "),s("code",[t._v("docker ps")]),t._v(" 命令找到 "),s("code",[t._v("kube-apiserver")]),t._v(" 容器，再使用 "),s("code",[t._v("docker restart")]),t._v(" 即可生效。")])])}),[],!1,null,null,null);a.default=e.exports}}]);